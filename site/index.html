<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script type="text/javascript" src="d3/d3.v3.js"></script>
        <style type="text/css">
		
			.axis path,
			.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			
			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}
		
		</style>
    </head>
    <body>
    <button>update</button>    
        <script type="text/javascript">
            
            //Width and height
            var w = 800;
            var h = 800;
            var padding = 40;
            
            var users = [
                  {
                    user: 0,
                    color: "#149314",
                    pos:  [[20, 70], [30, 80], [40, 85], [50, 95]]
                  },
                 {
                    user: 1,
                    color: "#3d3dc3",
                    pos:  [[60, 110], [70, 120], [80, 135], [90, 155]]
                  },
                {
                    user: 2,
                    color: "#d6203c",
                    pos:  [[90, 140], [100, 160], [120, 205], [110, 210]]
                  },
                
                {
                    user: 3,
                    color: "#ba00ff",
                    pos:  [[45, 30], [35, 20], [40, 15], [50, 25]]
                  },
                {
                    user: 4,
                    color: "#d6203c",
                    pos:  [[20, 145], [120, 110], [90, 105], [120, 130]]
                  },
                
                 {
                    user: 5,
                    color: "#d6500c",
                    pos:  [[50, 50], [90, 20], [10, 95], [60, 90]]
                  }
            ];
            
            
            var key = function(d){
                return d.user;
            };
            
            var getColor = function(d){
                return d.color;
            };
                    
            var getPosition = function(d){
                return d.pos;  
            };
            
            var getX = function(d){
                return xScale(d[0]);   
            };
            
            var getY = function(d){
                return yScale(d[1]);
            };
            
            var pointLabel = function(d, i, j){
                return j + " - " + i + " : (" + d[0] + ", " + d[1] + ")";
            };
            
            
            var updateData = function(d){
                //updating the data
                series.selectAll("circle")
                     .data(function(d){
                         console.log(d.user);
                        return d.pos;  
                     })
                     .transition()
                     .duration(1000)
                     .attr("cx", getX)
                     .attr("cy", getY)
                    .attr("r", function(d, i) {
                        console.log("updating to " + d[0] + ", " + d[1]);
                        return rScale(d[0])*((i+1)%5 + 1);
                        })
                    .style("opacity", function(d, i) {return (i+1)/4;});

                //drawing the labels
                series.selectAll("text")
                     .data(getPosition)
                     .transition()
                     .duration(1000)
                     .attr("x", getX)
                     .attr("y", getY)
                     .text(pointLabel)
            };
            

            //calculating the scale using the maximum position location values
            var xScale = d3.scale.linear()
                     .domain([0, d3.max(users, function(d, i) {  
                         return d3.max(d.pos, function(d, i){ 
                             return d[0]
                         }) 
                     })])
                     .range([padding, w - padding*2]);
            
            var yScale = d3.scale.linear()
                     .domain([0, d3.max(users, function(d, i) {  
                         return d3.max(d.pos, function(d, i){ 
                             return d[1]
                         }) 
                     })])
                     .range([h - padding, padding]);
            
            var rScale = d3.scale.linear()
                     .domain([0, 300])
                     .range([2, 5]);
            
            //Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(5);

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(5);
            
            
            var svg = d3.select("body")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);
            
                        
            
            //getting all of the data points
            var series = svg.selectAll("series")
                .data(users).enter().append("svg:g")
                .attr("class", "series")
                .style("fill", getColor);         

            //drawing the circles
            var circles = series.selectAll("circle")
                 .data(getPosition)
                 .enter().append("circle")
                 .transition()
                 .duration(1000)
                 .attr("cx", getX)
			     .attr("cy", getY)
                .attr("r", function(d, i) {
			   		return rScale(d[0])*((i+1)%5 + 1);
                    })
                .style("opacity", function(d, i) {return (i+1)/4;});
            
            //drawing the labels
            series.selectAll("text")
                 .data(getPosition)
                 .enter().append("text")
                 .attr("x", getX)
			     .attr("y", getY)
                 .text(pointLabel)
                 .attr("font-family", "sans-serif")
			     .attr("font-size", "11px")
			     .attr("fill", "black");
            

            //Create X axis
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (h - padding) + ")")
				.call(xAxis);
			
			//Create Y axis
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);
            
            
            d3.select("button").on("click", function(d){
              console.log("button clicked");
               
                users = [
                  {
                    user: 0,
                    color: "#149314",
                    pos: [[60, 110], [70, 120], [80, 135], [90, 155]]   
                  },
                 {
                    user: 1,
                    color: "#3d3dc3",
                    pos:  [[90, 140], [100, 160], [120, 205], [110, 210]]
                  },
                {
                    user: 2,
                    color: "#d6203c",
                    pos:  [[20, 70], [30, 80], [40, 85], [50, 95]] 
                  },
                
                {
                    user: 3,
                    color: "#ba00ff",
                    pos:   [[20, 145], [120, 110], [90, 105], [120, 130]] 
                  },
                {
                    user: 4,
                    color: "#d6203c",
                    pos:  [[50, 50], [0,0], [10, 95], [60, 90]]
                  },
                
                 {
                    user: 5,
                    color: "#d6500c",
                    pos:   [[45, 30], [35, 20], [40, 15], [50, 25]] 
                  }
            ];
                
                series.data(users);
                updateData(series);
                     
                    
                return d;
            });
            
        </script>
    </body>
</html>     