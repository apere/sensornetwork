<!-- 
Adam M. Pere
Involution Studios
January 2014

This is a scatter plot to create the framework for my person tracking application.
The data is broken up by users (or people in the studio). Each user has 4 points (this may change)
that represent their current location (the largest most opaque dot) and thier last 3 previous locations
(the smaller more opaque dots).

Project: InvoLive
This is a 2d birds eye view of the studio (bare bones simply to illustrate the idea).

Each set of colored dots represents a person and their motion path. The largest and most opaque dot is the current location of the person and the smaller less opaque dots are their past locations (aka their walking/motion path). 

The further apart the dots are, the faster he/she is moving. The closer they are, the slower he/or she is moving. 

Once I get the tracking working, I plan on adding more detail (furniture and other fun) to the map and making it look nicer. 

Other future plans:
- To get live video with data overlaid
- Collect studio data and map overtime/compare dates
- To get tracking in multiple rooms
- To identify people (are they in the studio: fitbit, phone connected to wifi, computer connected to network, etc. Hot Zones (aka people's working areas)
- Finding other possible data to collect: heat across the room, etc.
-->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script type="text/javascript" src="d3/d3.v3.js"></script>
        <style type="text/css">
                
                        .axis path,
                        .axis line {
                                fill: none;
                                stroke: black;
                                shape-rendering: crispEdges;
                        }
                        
                        .axis text {
                                font-family: sans-serif;
                                font-size: 11px;
                        }
                
                </style>
        
    </head>
    <body>
    <button type ="button" id="update" class ="update" name="update">Update All</button>
    <button type ="button" id="updateOne" class ="updateOne" name="updateOne">Update One</button>    
    <button type ="button" id="add" class ="add" name="add">Add New</button> 
    <button type ="button" id="remove" class ="remove" name="remove">Remove</button>
     
     
    
    
        <script type="text/javascript">
            
            //Width and height
            var w = 800;
            var h = 800;
            var padding = 40;
            
            var users = [
                  {
                    user: 0,
                    color: "#149314",
                    pos:  [[20, 70], [30, 80], [40, 85], [50, 95]],
                    pastPos:[]  
                  },
                 {
                    user: 1,
                    color: "#3d3dc3",
                    pos:  [[60, 110], [70, 120], [80, 135], [90, 155]],
                    pastPos:[] 
                  },
                {
                    user: 2,
                    color: "#d6203c",
                    pos:  [[90, 140], [100, 160], [120, 205], [110, 210]],
                    pastPos:[] 
                  },
                
                {
                    user: 3,
                    color: "#ba00ff",
                    pos:  [[45, 30], [35, 20], [40, 15], [50, 25]],
                    pastPos:[] 
                  },
                {
                    user: 4,
                    color: "#d6203c",
                    pos:  [[20, 145], [120, 110], [90, 105], [120, 130]],
                    pastPos:[] 
                  }
            ];
            
            var animate = function(){                
                var circ = svg.selectAll("#circle0")
                            .transition()
                            .duration(1000)
                            .attr("r", 20)
                            .style("stroke-width", 2);
                
                circ.transition()
                    .duration(1000)
                    .attr("r", radiusAnimate)
                    .style("stroke-width", 1);  
            };
            
            var key = function(d){
                return d.user;
            };
            
            var getColor = function(d){
                return d.color;
            };
                    
            var getPosition = function(d){
                return d.pos;  
            };
            
            var getX = function(d){
                return xScale(d[0]);   
            };
            
            var getY = function(d){
                return yScale(d[1]);
            };
            
            var pointLabel = function(d, i, j){
                return j + " - " + i + " : (" + d[0] + ", " + d[1] + ")";
            };
            
            var radius = function(d,i){
                return rScale(((1/(i+1))*10));
            }
            
            var radiusAnimate = function(d,i){
                return rScale(((1/(1))*10));
            }
            
            var opact = function(d, i) {
                return 1/(i+1) *1.5;
            }
            
            var updateData = function(d){
            //updating the scales
                xScale.domain([0, d3.max(users, function(d, i) {  
                         return d3.max(d.pos, function(d, i){ 
                             return d[0]
                         }) 
                     })])
                     .range([padding, w - padding*2]);
            
                yScale.domain([0, d3.max(users, function(d, i) {  
                         return d3.max(d.pos, function(d, i){ 
                             return d[1]
                         }) 
                     })])
                     .range([h - padding, padding]);
                
                series = series.data(users,  key);
                
            //New elements
                //Adding a new user
                series.enter().append("svg:g")
                        .attr("class", "series")
                        .style("fill", getColor);
                        
                //adding new circles
                series.selectAll("circles").data(getPosition)
                        .enter()
                        .append("circle")
                        .attr("id", function(d, i){return "circle" + i})
                        .attr("cx", 0)
                        .attr("cy", 0);
                
                //adding new labels
                series.selectAll("text")
                     .data(getPosition)
                     .enter().append("text")
                     .attr("x",0)
                     .attr("y", 0)
                     .text(pointLabel)
                     .attr("font-family", "sans-serif")
                     .attr("font-size", "11px")
                     .attr("fill", "black");
                
            //Updating current elements
                //updating all of the circles
                series.selectAll("circle")
                     .data(function(d){
                        return d.pos;  
                     })
                     .transition()
                     .duration(1000)
                     .attr("cx", getX)
                     .attr("cy", getY)
                    .attr("r", radius)
                    .style("opacity", opact);

                //updating all of the labels
                series.selectAll("text")
                     .data(getPosition)
                     .transition()
                     .duration(1000)
                     .attr("x", getX)
                     .attr("y", getY)
                     .text(pointLabel)
                  
            //Removing all elements associated with data that no longer exists
                series.exit()
                        .transition()
						.duration(100)
						.attr("cx", w)
                        .attr("x", w)
						.remove();
                
                //Update X axis
				svg.select(".x.axis")
				    .transition()
				    .duration(1000)
				.call(xAxis);
					
				//Update Y axis
				svg.select(".y.axis")
				    .transition()
				    .duration(1000)
				    .call(yAxis);
            };
            

            //calculating the scale using the maximum position location values
            var xScale = d3.scale.linear()
                     .domain([0, d3.max(users, function(d, i) {  
                         return d3.max(d.pos, function(d, i){ 
                             return d[0]
                         }) 
                     })])
                     .range([padding, w - padding*2]);
            
            var yScale = d3.scale.linear()
                     .domain([0, d3.max(users, function(d, i) {  
                         return d3.max(d.pos, function(d, i){ 
                             return d[1]
                         }) 
                     })])
                     .range([h - padding, padding]);
            
            var rScale = d3.scale.linear()
                     .domain([1,4])
                     .range([3, 10]);
            
            //Define X axis
            var xAxis = d3.svg.axis()
                        .scale(xScale)
                        .orient("bottom")
                        .ticks(5);

            //Define Y axis
            var yAxis = d3.svg.axis()
                        .scale(yScale)
                        .orient("left")
                        .ticks(5);
            
            var svg = d3.select("body")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);
            
                      
            
            //getting all of the data points
            var series = svg.selectAll("series")
                .data(users, key).enter().append("svg:g")
                .attr("class", "series")
                .style("fill", getColor);
                

            //Adding the circles
            var circles = series.selectAll("circle")
                 .data(getPosition)
                 .enter().append("circle")
                 .transition()
                 .duration(1000)
                 .attr("id", function(d, i){return "circle" + i})
                 .attr("cx", getX)
                 .attr("cy", getY)
                 .attr("r", radius)
                 .style("opacity", opact)
                 .style("stroke", "#d4d1d1");
            
            //drawing the labels
            series.selectAll("text")
                 .data(getPosition)
                 .enter().append("text")
                 .attr("x", getX)
                 .attr("y", getY)
                 .text(pointLabel)
                 .attr("font-family", "sans-serif")
                 .attr("font-size", "11px")
                 .attr("fill", "black");
            

			//Create X axis
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + (h - padding) + ")")
				.call(xAxis);
			
			//Create Y axis
			svg.append("g")
				.attr("class", "y axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);
            
            
            //Actions for clicking button
            d3.selectAll("button").on("click", function(d){
              
               var buttonID = d3.select(this).attr("class");
                
                if( buttonID == "add") {
                        users.push({ 
                            user: 5,
                            color: "#20bad6",
                            pos:  [[70, 40], [75,34], [99, 80]],
                            pastPos: []
                        });   
                                      
                }else if(buttonID == "update") {
                    users[0].pos = [[60, 110], [70, 120], [80, 135], [90, 155]] ;
                    users[1].pos = [[90, 140], [100, 160], [120, 205], [110, 210]];
                    users[2].pos = [[20, 70], [30, 80], [40, 85], [50, 95]];
                    users[3].pos = [[20, 145], [120, 110], [90, 105], [320, 330]];
                    users[4].pos = [[50, 50], [0,0], [10, 95], [60, 300]];

                }else if(buttonID == "remove") {
                    users.shift();
                
                }else if(buttonID == "updateOne") {
                    var temp = users[0].pos.pop();
                    users[0].pastPos.unshift(temp);
                    users[0].pos.unshift([100,200]);
                    
                    }
               
                updateData(series);
                return d;
            });
            
            //setInterval(animate, 2500);
            
        </script>
        
    </body>
</html>     